# 4阶轨迹规划算法介绍

![](..\..\picture\4阶轨迹规划15段.png)

​		上图所示的为一种典型的完整对称4阶轨迹轮廓，所示的轨迹规划可由4段时间唯一确定，最大加加速度斜率时间段$t_d$，最大加加速度时间段$t_j$，最大加速度时间段$t_a$，最大速度时间段$t_v$。确定了以上4段时间，即确定了算法实现过程中所需的所有切换点时间$t_0,t_1,t_2,\cdots t_{15}$，显然，不同的4段时间值确定不同的轨迹轮廓，15段是在4阶轨迹规划时所有时间段都存在的情况。

​		因此，4阶轨迹规划算法即是在保证轨迹规划实用目标的基础上，一句给定的约束条件，依次确定时间段$t_d、t_j、t_a、t_v$的规划过程。步骤如下：

*   最大加加速度斜率时间段$t_d$的确定。
*   最大加加速度时间段$t_j$的确定。
*   最大加速度时间段$t_a$的确定。
*   最大速度时间段$t_v$的确定。

​		给定4阶轨迹的约束条件为运动距离$s$，最大运动速度$v_{max}$，最大加速度$a_{max}$，最大加加速度$j_{max}$，最大加加速度斜率$d_{max}$.

​		根据积分原理，我们可以得知，加加速度是加加速度斜率的一重积分，加速度为加加速度斜率的二重积分，速度为加加速度斜率的三重积分，位置则为加加速度斜率的四重积分。因此，可以得到以下的公式：
$$
\left.
\begin{array}{}
j(t)&=j_0+dt \qquad \\
a(t)&=a_0+j_0t+dt^2/2\qquad \\
v(t)&=v_0+a_0t+j_0t^2/2+dt^3/6\qquad \\
s(t)&=s_0+v_0t+a_0t^2/2+j_0t^3/6+dt^4/24 \qquad 
\end{array}
\right\}
\tag{1}
$$
​		式中，$j_0,a_0,v_0,s_0$为初始边界条件，$t$为时间。

## 确定最大加加速度斜率时间段的最优值

​		首先不考虑最大加加速度、最大加速度和最大速度限制。在满足运动距离的前提下，建立运动距离与最大加加速度斜率的关系，因此，$t_j=t_a=t_v=0,t_2=t_1=t_d,t_4=t_3=2 t_d,t_6=t_5=3 t_d,t_8=t_7=4 t_d$

![](..\..\picture\4阶轨迹规划6段.png)

整个轨迹的执行时间$t_s=8t_d$，设定初始时刻和结束时刻的加加速度、加速度和速度均为0，可以得到公式(1)中的初始条件为$j_0=0，a_0=0，v_0=0，s_0=0$，可以得到$t_1$时刻的计算公式为：
$$
\left.
\begin{array}{}

j(t_1)=d_{max}t_d\\
a(t_1)=d_{max}t_d^2/2\\
v(t_1)=d_{max}t_d^3/6\\
s(t_1)=d_{max}t_d^4/24\qquad

\end{array}
\right\}
\tag{2}
$$
在$t_3$时刻，有$d=-d_{max}$，则：
$$
\left.
\begin{array}{}
j(t_3)=0\\
a(t_3)=d_{max}t_d^2\\
v(t_3)=d_{max}t_d^3\\
s(t_3)=7d_{max}t_d^4/12 \qquad
\end{array}
\right\}
\tag{3}
$$
依次类推，可以得到$t_7$时刻的计算公式：
$$
\left.
\begin{array}{}
j(t_7)=0\\
a(t_7)=0\\
v(t_7)=2d_{max}t_d^3\\
s(t_7)=4d_{max}t_d^4\qquad
\end{array}
\right\}
\tag{4}
$$
根据轨迹轮廓对称性，$s(t_{15})=2(s_{7})=s$，所以可以得到由运动距离所确定的最大加加速度斜率段时间为
$$
t_d=\sqrt[4]{s/(8d_{max})}
\tag{5}
$$

*   引入最大速度限制。最大速度在$t_7$时刻到达，即由$t_d$时间所确定的最大速度值为

$$
v_d=2d_{max}t_d^3
\tag{6}
$$

​		比较给定的最大速度$v_{max}$与计算得到的$v_d$,若$v_{max}>v_d$,则$t_d$满足最大速度限制要求，否则按最大速度限制重新计算$t_d$：
$$
t_d=\sqrt[3]{v_{max}/(2d_{max})}
\tag{7}
$$

*   引入最大加速度限制。最大加速度在$t_3$时刻到达，即由$t_d$时间所确定的最大加速度值为

$$
a_d=d_{max}t_d^2
\tag{8}
$$

