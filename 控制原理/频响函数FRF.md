# 频响函数FRF

## **FRF**定义

平常所说的频响函数FRF，他是结构的输出响应和输入激励之比。我们同时测量激励力和由该激励力引起的结构响应(这个响应可能是位移、速度或加速度),将测量的时域数据通过快速傅里叶变换(FFT)从时域变换到频域，经过变换，频域函数最终呈现为复数形式，包括实部与虚部，或者是幅值与相位。

我们可以将频响函数写成部分分式形式：
$$
[H(jw)]=\sum_{k=1}^{m}\left(\frac{[A_k]}{(jw-P_k)}+\frac{[A_k^*]}{(jw-P_k^*)}\right)
$$

我们常用矩阵形式来处理频响函数，所以用下标可以方便地确定某个输入-输出位置的FRF。例如由$j$点输入激励引起$i$点的输出响应，那么**FRF**中的元素为$h_{ij}$，定义为$j$点单位激励力在$i$点引起的响应。第一个下标表示输出响应位置，第二个下标表示输入激励位置。

FRF元素的分子中包含留数，而留数与模态振型直接相关；分母包含系统极点信息，也就是系统的频率和阻尼信息。因此，从频响函数矩阵可以得到系统全部的模态信息。频响函数矩阵中的单个元素可以写成（下标$k$表示阶数）
$$
[H(jw)]=\sum_{k=1}^{m}\left(\frac{[A_{ijk}]}{(jw-P_k)}+\frac{[A_{ijk}^*]}{(jw-P_k^*)}\right)
$$
该方程主要由系统每一阶模态的留数（分子）和极点（分母）来描述。将频响函数用模态振型表示为:
$$
[H(jw)]=\sum_{k=1}^{m}\left(\frac{q_ku_{ik}u_{jk}}{(jw-P_k)}+\frac{q_k^*u_{ik}^*u_{jk}^*}{(jw-P_k^*)}\right)
$$
从这个方程可以清楚地看出FRF的幅值受**输出响应位置的模态振型值**乘以**输入激励位置模态振型值**的控制。这个频响函数可以用任何一个感兴趣的输入-输出组合来表示。

这个方程感兴趣的部分是留数和极点，虽然留数的改变依赖于特定的输入-输出组合，但是极点保持不变。这暗示着系统极点是全局特性，它们独立于特定的输入-输出位置。也就是说从一个输入-输出位置就能测量到系统的所有极点（频率和阻尼）信息。因此，固有频率测量，理论上讲，只需要一个测量位置即可测量出所有的模态频率（实际测量时要避开节点位置）。

然而，留数却依赖于特定的输入-输出位置，随输入-输出位置的变化而变化。也就是说不同输入-输出位置的留数是不相同的，这就说明了为什么测试模态振型时，需要大量的测点。这是因为不同测点的留数是不同的，留数是局部特征，留数不同也就是振型值不同，因此，振型依赖于不同的测量位置，为了将振型唯一地描述出来，要求测点数目尽量多，通过这些测点位置的振型值能唯一地表征这些模态的振型。

当我们用模态振型写出这个方程时，结构的模态振型对于特定ij位置的**FRF**幅值有强烈的影响，这一点就变得非常清晰了。留数本质上由振型缩放系数，q，和响应输出位置的模态振型值乘以输入激励位置的模态振型值。这表示，如果输出位置或者输入位置的模态振型值为0（也就是位于模态节点上），那么这阶模态就没有幅值，这一点就变得非常清晰了。因此，模态参考点要避开节点。

## FRF性质

频响函数FRF具有以下性质：

1. 频响函数定义为输入位置单位激励力引起的输出位置的响应。
2. 频响函数是系统的固有特性，与系统本身有关，与激励、响应等外界因素没有关系。
3. 频响函数具有互易性，即$H_{ij}=H_{ji}$，也就是说，$j$点单位激励力在$i$点引起的响应等于$i$点单位激励力在$j$点引起的响应，这也表明频响函数矩阵是对称的。
4. 频响函数是复值函数，因而可以用幅值与相位或者实部与虚部表示，因此频响函数具有幅频、相频和实频、虚频等多种表现形式。当幅频曲线和相频曲线同时显示时，称为伯德图，如下图所示

![image-20210304140503141](..\picture\image-20210304140503141.png)

5. 频响函数矩阵包括系统全部的模态信息，矩阵中每一行或每一列同样包含系统全部的模态信息。这些**FRF**由留数和系统极点组成，而留数直接与模态振型相关，极点包含系统的频率和阻尼信息。所以组成**FRF**的参数正是我们希望从**FRF**中提取的参数。这就是模态参数估计过程。通常我们通过数学运算从FRF中提取组成FRF的参数：频率、阻尼和模态振型。这个过程通常称为**曲线拟合**。提取的基本信息是模态振型和系统极点，而模态振型与留数矩阵相关，极点信息与系统矩阵的行列式相关。

## **FRF**形式

在这主要介绍两个方面：FRF的表现形式和表达形式。表现形式是指可以用幅值与相位或实部与虚部来描述。而表达形式是指可以用加速度、速度或位移与激励力之比来表达。

由于频响函数是复值函数，因而可以用幅值与相位或者实部与虚部来表示，因此，频响函数具有幅频与相频和实频与虚频等多种表现形式，另外还要介绍一种特殊的图形表现形式即**奈奎斯特图**。

下面两图为同一个频响函数不同的表现显示：幅值与相位和实部与虚部。实质上实数与虚部是直角坐标下的复数形式，而幅值与相位是极坐标下的复数形式。因此，二者本质是相同的，只是采用的坐标系不同而已。人们对复数形式的频谱更易理解和更常见的是用幅值和相位的显示形式。

![image-20210304140912897](..\picture\image-20210304140912897.png)

在幅值与相位图中，幅值的极值表征一阶模态，在模态频率处，相位变化180度（无阻尼结构）。在实部与虚部图中，在模态频率处，实部为0，虚部达到极值。另外，还有一点，早期有一种模态算法，称为峰值拾取法，就是把所有测点在某一阶的虚部峰值连接起来，即为这阶模态振型。

在这我们要记得一个结论：实模态的固有频率和复模态的固有频率相等，因此，二者的FRF重合。但是FRF的不同表现形式中，只有幅值谱是重合的，实部和虚部不重合，有偏移，如下图所示。如果这时用实部或虚部进行模态参数提取，就会出现频率提取不准确，而用幅值谱，则不存在这样的问题。因此，模态参数提取时用的是频响函数的幅值谱，而非实部和虚部

![image-20210304141229297](..\picture\image-20210304141229297.png)

同一个复数形式的频谱还可以用之前两种方式之外的方式来表示：要么实部频谱对虚部频谱，要么幅值谱对相位谱。这类绘图形式，就是众所周知的**奈奎斯特图**，如下图所示，显示的还是之前那条频响函数。

![image-20210304141310016](..\picture\image-20210304141310016.png)

奈奎斯特图中每一点表示特定频率下的复数振幅。它描述的是特定点的响应的幅值和相位是如何随频率变化的。关于用奈奎斯特图显示FRF，在这里要说得更详细一些，因为大多数工程师对它都不太了解。

从之前显示的这条频响函数的幅值谱可以看出，在这个频带内有4阶模态。将该条频响函数用奈奎斯特图表示，如上图所示。奈奎斯特图中每一个圆表征一阶模态。在上图中有4个圆，对应于幅值图中的4阶模态。圆的大小对应幅值图中FRF峰值的幅值。也就是说，最大的圆对应的是第2阶（FRF幅值最高），**幅值相位图中共振峰的幅值大小顺序对应于奈奎斯特图中圆的大小**。并且，当光标位于共振频率处时，奈奎斯特图中的虚部是最大。

前面介绍的是FRF的表现形式，在这里再介绍FRF的表达形式。由于响应可以用位移、速度和加速度来表征，因此，当频响函数用不同的物理量来表征时，表征的物理意义也有所区别，具体如下表所示。

我们经常测试动刚度，特别是原点动刚度，实质是基于频响函数测量方法进行的。并且通常测试时使用加速度作为响应，测量频响函数得到动刚度曲线。下图为同一位置的加速度频响函数和该点的动刚度曲线。

![image-20210304145227245](..\picture\image-20210304145227245.png)

从上图可以看出，频响函数极大值对应的是动刚度曲线的极小值，也就是说频响函数幅值大的频率处，动刚度小。在该频率处，很小的激励就容易把结构激励起来。而频响函数幅值小的频率处，动刚度大，结构很难或不能被激励起来。

## 共振峰和反共振峰

在频响函数曲线中，共振频率所对应的峰称为**共振峰**，在这个峰值处，对结构施加很小的激励能量，结构就会产生非常大的振动，因而在共振峰处，结构很容易被激励起来。

当以dB形式显示频响函数时，特别当FRF为驱动点FRF时，会发现FRF曲线中有向下的峰值，这些峰称为**反共振峰**，如下图上面曲线所示，在线性显示的FRF中，看不出来反共振峰，如下图下面曲线所示。这是因为在反共振峰处，对应的幅值为0，在线性显示方式中，就看不出来反共振峰了。而以dB形式显示时，幅值越接近0，则dB值越小，因此，反共振峰明显。

![image-20210304145415406](..\picture\image-20210304145415406.png)

在反共振峰所对应的频率处进行激励，即使激励能量再大，结构也没有响应或者响应很微弱，也就是说在反共振峰所对应的频率处，结构很难被激励起来。在这个频率处可以理解为结构的刚度无限大，其实从上图中也可以看出这一点。 

因此，当外界的激励频率处于结构的反共振峰处时，外界激励对结构的影响是最小的。这有点类似于激励位置位于结构的模态节点处时，外界的激励对结构影响也是最小的。但二者的区别在于一个是按频率来区分的，一个是按位置来区分的。

若不考虑输入输出噪声，则共振峰处所对应的相干等于1，这是因为结构的响应完全是由激励引起的，而在反共振峰处，相干很小（相干系数下坠），这是因为此时响应和激励之间，二者没有因果关系，所以相干很小。

因为在反共振峰处，即使激励力再大，结构也没有响应或者响应很微弱，所以，响应与激励之间不存在因果关系，因而，相干系数往下掉。

## 单自由度FRF

单自由度模型只有一阶模态，因此，FRF只有一个峰值。单自由度的FRF如下:
$$
H(jw)=\left(\frac{A_k}{(jw-\lambda)}+\frac{A_k^*}{(jw-\lambda)}\right)
$$
或为:
$$
H(jw)=\frac{X(jw)}{Y(jw)}=\left(\frac{1}{(k-mw^2)*jcw}\right)
$$
单自由度的频响函数如下图所示。

![image-20210304145938963](..\picture\image-20210304145938963.png)

在低频段，FRF的幅值是$1/k，(k>>w^2m+jwc)$，相位为0，表明共振频率以下的频率段主要用占主导地位的刚度项来描述。

在高频段，FRF的幅值为$-1/w^2m (w^2m>>jwc+k)$，相位为 -180º，表明共振频率以上的频率段主要用占主导地位的质量项来描述。

理论上，无阻尼固有频率处的FRF幅值应是无穷大，但是由于阻尼的存在，导致共振频率处的幅值不会无穷大，其幅值为$1/wc$，相位突变180º，表明在共振频率处主要受阻尼控制。

由于响应可以用位移、速度和加速度来表征，因此，当频响函数用不同的物理量来表征时，表征的物理意义也有所区别，具体如下表所示。在这六种表达形式中，最广泛使用的是加速度/力和力/位移，即**加速度导纳**和**动刚度**，如图中红色标识

![image-20210304151436271](..\picture\image-20210304151436271.png)

这6种表达形式下的无阻尼单自由度系统的曲线如下图所示（对数尺度）。

![image-20210304151503773](..\picture\image-20210304151503773.png)

## 驱动点和跨点FRF

如果响应点和激励点为同一点，同一个方向测量得到的频响函数称为**驱动点频响**或**原点频响**。如果响应点和激励点不满足这个要求，则测得的频响函数称为**跨点频响**，也就是激励和响应不在同一位置或同一方向，典型的驱动点和跨点测量如下图所示。

![image-20210304151545964](..\picture\image-20210304151545964.png)

如这根悬臂梁的典型驱动点测量（第3个位置）结果如下图所示。

![image-20210304151613389](..\picture\image-20210304151613389.png)

驱动点FRF可以看成是所有模态的叠加或者是每阶模态引起的贡献。上图显示的四个子图中，每幅图上边的曲线图为所有模态的叠加，下面的曲线图为每阶模态（单自由度模型）的贡献。对于图示的前三阶模态，频响函数由三阶单自由度系统叠加组成。

驱动点频响函数具有一些重要的特征：

* 幅值曲线中共振峰和反共振峰交替出现；

* 每经过一个共振峰时相位滞后180度，每经过一个反共振峰时相位超前180度；

* 频响函数虚部的所有峰值方向相同。

 

跨点FRF的性质：

* 无反共振峰出现

* FRF曲线为“马鞍状”

* 经过共振峰相位滞后180度

* 虚部峰值有正有负

很多时候，在测试的开始阶段，人们只检查驱动点测量。虽然这是系统测试过程中比较关键的一次测量，特别是考虑模态振型缩放时，但是驱动点FRF不总是用于检查测量效果最理想的函数。比如，驱动点FRF的虚部的各个峰值总是具有相同的相位关系。但是如果两阶模态彼此非常靠近，那么有时就很难确定数据中实际存在多少阶模态。

这个时候，更合适的是检查一条跨点的FRF。注意到跨点FRF的虚部所有峰值不存在相同的相位关系。这对确定空间上非常接近的密集模态相当有用，在测试初期应该总是作这个检查。

另外，当对结构进行动力学修改时，驱动点的FRF是必需的。

## 为什么有的FRF有反共振峰，有的没有

当用dB形式显示FRF曲线时，有的FRF存在共振峰，而有的不存在共振峰，这是为什么呢？

通过上面的分析，我们已经明白了驱动点FRF的虚部各峰值具有相同的方向，驱动点FRF幅值图中，各阶模态之间存在反共振峰。这是因为模态1和模态2在反共振频率处幅值相等，但是彼此的相位却相差180度（从下图中的幅值和相位分解图中可以看出这一点）。

![image-20210304151956094](..\picture\image-20210304151956094.png)

这就意味着模态1和模态2的幅值大小是相等的，但是二者是反向的。因此频响函数在反共振峰处幅值趋向于零（当然这还有其他阶模态的贡献，但是通常离得越远，其贡献量也就越小）。

这暗示着当各阶模态的虚部符号相反时，相位未必反向，因而模态叠加时，反共振峰不会出现。因此，每条FRF中是否出现反共振峰（不出现反共振峰时，FRF的形状是马鞍状）取决于频响函数虚部的方向。

当频响函数相邻两阶模态的虚部同方向时，那么在这两阶模态之间出现反共振峰；当频响函数相邻两阶模态的虚部反方向时，那么在这两阶模态之间不会出现反共振峰，这时频响函数的形状为马鞍状。

## 力锤FRF与激振器FRF区别

**从理论角度上讲：**

1. 力锤：得到FRF矩阵的一行；

2.  激振器：得到FRF矩阵的一列；

3.  FRF矩阵是对称阵，互易性成立；

4.  对结构施加一纯力，该力与结构不存在相互作用，且用一个无质量的传感器测量响应。

因此，从理论上讲，由力锤和激振器激励得到的FRF没有区别，但这仅仅是从理论角度上讲 。 ![image-20210304161755921](..\picture\image-20210304161755921.png)

**现实区别：**

1. 激振器和响应传感器往往对结构都有影响；

2. 处于测试状态下的待测结构不再是最初那个要提取模态参数的结构，还要考虑结构安装条件、传感器附加质量、激振器顶杆弯曲刚度影响等方面；

3. 因采集数据的实际条件所致，它们是有区别的；

4. 最显著的区别在于激振器激励时，移动加速度传感器，结构变成了时变系统，特别是轻质结构；

5.  相对整个结构的总质量而言，加速度传感器的重量非常小，但相对结构不同部分的有效质量而言又是很大的，特别是在轻质结构上移动多个传感器；

6.  激振器的顶杆可能会引入弯曲刚度，带来影响。

因此，采用不同的激励方式，得到的频响函数实质上是有区别的。

## FRF计算

对于SISO或SIMO测试方式下的频响函数计算， 无论是锤击法测试还是激振器测试，都需将捕捉到的时域数据通过FFT变换到频域。FFT变换提供输入和输出信号的线性傅立叶频谱。然后计算输入自谱(Gxx)，输出自谱(Gyy)和输入-输出的互谱(Gyx)。这三个谱函数使用各自的数据纪录进行平均（假设平均N次）。

一旦得到Gxx、Gyx 和Gyy，那么就可计算频响函数和相干了。虽然频响函数可以使用不同形式的估计，但当今绝大多数单输入模态测试中，H1是频响函数最常用的估计形式，计算过程如下图所示。

![image-20210304162403772](..\picture\image-20210304162403772.png)

对于单个激励源的FRF计算相对来说比较简单，得到的相干也是我们通常意义上的常相干。但若是多个激励源，FRF计算则要复杂得到，得到的不再是我们常用的常相干了，有可能是重相干，也有可能是偏相干，视商业软件而定。如LMS Test.Lab中则为重相干，关于这一点，下边会有简单介绍。

当用两个或两个以上的激励源时，通常是使用激振器进行测试，采用的方式是MIMO。而对于MIMO方式下的频响函数计算，由于每一个测点位置的响应来自多个激励力的作用，因此，计算FRF时，有别于单激励力下的FRF计算。

现假设2个激励源，对应为1#和2#，计算第i个测点位置的FRF，平均50次，则未知量为$H_{i1}$和$H_{i2}$。假若两个激励力是线性无关的，此时2个未知量，则至少需要2个方程，也就是需要平均2次才能求解出这2个FRF，并且要求这两次平均是线性无关的才可以求解出这两个未知数。

但现实中，这两次不可能是完全线性无关的，因此需要更多的平均；另一方面，结构可能存在轻微非线性，多次平均可以起到平均掉轻微非线性和去噪的功能。若平均50次，求出50次平均下的两个FRF后，最后通过最小二乘拟合方法得到最终的两个FRF，如下表所示。

![image-20210304180951526](..\picture\image-20210304180951526.png)

**重相干**描述单一信号（输出谱）与另外一组视为参考信号（输入谱）之间的因果关系，它等于由多个输入信号引起的输出信号的能量与该组输出信号的总能量之比。

假设有2个激励信号，在某一测点的响应是来自这两个激励源引起的响应之和。那么重相干是这个响应与这两个激励的总能量之比。因此，重相干的数量与响应测量自由度的数量相同。如下图所示，有两个激励源，因此，这个测点有两个FRF，但是重相干数量为1。

![image-20210304181038283](..\picture\image-20210304181038283.png)

**偏相干**则是计算各自激励引起的响应与自身激励之比。假设某一测点既有1#激励源引起的响应，又有2#激励源引起的响应，则偏相干需要分别计算由1#激励引起的响应与1#激励之比和由2#激励引起的响应与2#激励之比。因此，偏相干的数量等于测量自由度乘以激励源数目。

## 估计类型

我们之前所讨论的频响函数计算公式是理想的情况，其输出完全由输入引起，没有任何噪声混杂进来。实际上这是不可能的，也就是输入输出中必然会包含噪声（此处的噪声是指干扰），因而人们为了减少噪声的影响，提出了各种估计方法，用于从实际测量的输入和输出信号出发估计出频响函数。进行FRF估计时，需要对每个频率进行估计。

$H_1$是最常用的估计类型，它假设输入没有噪声，输出有噪声。因而，所有的激励力测量都是准确的，但输出响应包含噪声，因此，对N个响应测量进行最小二乘估计，使得响应中的噪声最小化。由于输入没有噪声，因此，最后计算FRF时，用的是输入-输出的互谱比上输入的自谱，如下图左侧所示。

$H_2$估计与$H_1$估计刚好相反，假设输出响应无噪声，输入激励有噪声。因而，所有的响应测量都是准确的，但输入激励包含噪声，因此，对N个输入测量进行最小二乘估计，得到噪声最小的输入。由于输出没有噪声，计算FRF时，用的是输出的自谱比上输入-输出的互谱，如下图中间所示。

$H_v$估计是假设输入-输出中都包含噪声，因此，需要对输入和输出都采用最小二乘估计，得到噪声最小的输入和输出，然后再计算FRF，如下图右侧所示。

![image-20210304181304703](..\picture\image-20210304181304703.png)

## FRF的影响因素

通过单自由度的FRF，我们已经清楚了FRF不同区域受不同因素控制。这些因素主要是刚度、质量和阻尼，它们是怎么影响FRF的呢？

刚度的增加会导致共振频率的提高，这一点从频率计算公式很容易理解，并且降低频响函数在低频段的幅值。因为频响函数低频段刚度的影响具有支配性，因此把这段区域叫做**刚度线**或者**柔度线**。

![image-20210304181341579](..\picture\image-20210304181341579.png)

增大质量，我们都知道会降低共振频率，同时也降低频响函数在高频段的幅值。由于质量对高频段曲线起支配作用，所以单自由度系统的频响函数的高频段叫做**质量线**。

![image-20210304181403739](..\picture\image-20210304181403739.png)


这时如果再回看第6小节中的3个模态的分解形式，则会发现频率越高，低频段的幅值越小，而高频的幅值越大，也正是考虑了以上两个因素。

增加阻尼会使得共振频率略有减少，但是它的主要作用是减小频响函数在共振点的幅值，同时使得相位的改变较为平缓。

![image-20210304181428571](..\picture\image-20210304181428571.png)

如果阻尼为零，在共振点振动幅度将趋向无穷大，相位会突变180度，而且系统的极点将成为纯虚数，其大小等于无阻尼固有频率。但是阻尼越大，相位过渡越平滑，如下图所示。

![image-20210304182025404](..\picture\image-20210304182025404.png)

很多时候，人们通过相位的变化来判断是不是模态极点，如果是无阻尼的情况可能相位变化较明显，但如果是有阻尼，或者阻尼特别大，这个时候如果使用相位判定可能会不准确，因此，此时相位会平滑过渡。

明白以上规律，可以帮助我们在遇到实际问题时，如trouble shooting，应该朝哪个方向着手改进了。到底是增加刚度，还是质量或者加阻尼了。